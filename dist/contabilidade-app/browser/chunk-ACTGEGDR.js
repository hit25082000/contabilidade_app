import{a as M}from"./chunk-6WNS7CKB.js";import{b as Bt,c as qt,f as Wr,g as zt}from"./chunk-X5YLR3NI.js";import{$ as de,C as Z,Lc as Mt,Q as Nt,Qc as Ft,T as De,X as ee,_b as ut,l as B,n as X,p as ht,sa as fe}from"./chunk-QWKNK35R.js";import{e as L,g as Kr,h as Vr,i as u}from"./chunk-ODN5LVDJ.js";var gt=L(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});var ft=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};pt.default=ft});var mt=L(_e=>{"use strict";var Jt=_e&&_e.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(_e,"__esModule",{value:!0});var Qr=Jt((zt(),Vr(Wr))),Xr=Jt(gt()),_t=class{constructor(t){this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=t.headers,this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=t.shouldThrowOnError,this.signal=t.signal,this.isMaybeSingle=t.isMaybeSingle,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=Qr.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=Object.assign({},this.headers),this.headers[t]=e,this}then(t,e){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");let r=this.fetch,s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(n=>u(this,null,function*(){var o,a,c;let l=null,h=null,d=null,p=n.status,f=n.statusText;if(n.ok){if(this.method!=="HEAD"){let k=yield n.text();k===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?h=k:h=JSON.parse(k))}let m=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),v=(a=n.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");m&&v&&v.length>1&&(d=parseInt(v[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(h)&&(h.length>1?(l={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,d=null,p=406,f="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{let m=yield n.text();try{l=JSON.parse(m),Array.isArray(l)&&n.status===404&&(h=[],l=null,p=200,f="OK")}catch{n.status===404&&m===""?(p=204,f="No Content"):l={message:m}}if(l&&this.isMaybeSingle&&(!((c=l?.details)===null||c===void 0)&&c.includes("0 rows"))&&(l=null,p=200,f="OK"),l&&this.shouldThrowOnError)throw new Xr.default(l)}return{error:l,data:h,count:d,status:p,statusText:f}}));return this.shouldThrowOnError||(s=s.catch(n=>{var o,a,c;return{error:{message:`${(o=n?.name)!==null&&o!==void 0?o:"FetchError"}: ${n?.message}`,details:`${(a=n?.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(c=n?.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),s.then(t,e)}};_e.default=_t});var yt=L(me=>{"use strict";var Zr=me&&me.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(me,"__esModule",{value:!0});var es=Zr(mt()),vt=class extends es.default{select(t){let e=!1,r=(t??"*").split("").map(s=>/\s/.test(s)&&!e?"":(s==='"'&&(e=!e),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(t,{ascending:e=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){let o=n?`${n}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${t}.${e?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:r=e}={}){let s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${t}`),this}range(t,e,{foreignTable:r,referencedTable:s=r}={}){let n=typeof s>"u"?"offset":`${s}.offset`,o=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${t}`),this.url.searchParams.set(o,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:t=!1,verbose:e=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:o="text"}={}){var a;let c=[t?"analyze":null,e?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${l}"; options=${c};`,o==="json"?this:this}rollback(){var t;return((t=this.headers.Prefer)!==null&&t!==void 0?t:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};me.default=vt});var Be=L(ve=>{"use strict";var ts=ve&&ve.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ve,"__esModule",{value:!0});var rs=ts(yt()),wt=class extends rs.default{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}in(t,e){let r=Array.from(new Set(e)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`in.(${r})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:r,type:s}={}){let n="";s==="plain"?n="pl":s==="phrase"?n="ph":s==="websearch"&&(n="w");let o=r===void 0?"":`(${r})`;return this.url.searchParams.append(t,`${n}fts${o}.${e}`),this}match(t){return Object.entries(t).forEach(([e,r])=>{this.url.searchParams.append(e,`eq.${r}`)}),this}not(t,e,r){return this.url.searchParams.append(t,`not.${e}.${r}`),this}or(t,{foreignTable:e,referencedTable:r=e}={}){let s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${t})`),this}filter(t,e,r){return this.url.searchParams.append(t,`${e}.${r}`),this}};ve.default=wt});var St=L(we=>{"use strict";var ss=we&&we.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(we,"__esModule",{value:!0});var ye=ss(Be()),bt=class{constructor(t,{headers:e={},schema:r,fetch:s}){this.url=t,this.headers=e,this.schema=r,this.fetch=s}select(t,{head:e=!1,count:r}={}){let s=e?"HEAD":"GET",n=!1,o=(t??"*").split("").map(a=>/\s/.test(a)&&!n?"":(a==='"'&&(n=!n),a)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new ye.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(t,{count:e,defaultToNull:r=!0}={}){let s="POST",n=[];if(this.headers.Prefer&&n.push(this.headers.Prefer),e&&n.push(`count=${e}`),r||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(t)){let o=t.reduce((a,c)=>a.concat(Object.keys(c)),[]);if(o.length>0){let a=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",a.join(","))}}return new ye.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}upsert(t,{onConflict:e,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){let o="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(e!==void 0&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),n||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(t)){let c=t.reduce((l,h)=>l.concat(Object.keys(h)),[]);if(c.length>0){let l=[...new Set(c)].map(h=>`"${h}"`);this.url.searchParams.set("columns",l.join(","))}}return new ye.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}update(t,{count:e}={}){let r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),e&&s.push(`count=${e}`),this.headers.Prefer=s.join(","),new ye.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}delete({count:t}={}){let e="DELETE",r=[];return t&&r.push(`count=${t}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new ye.default({method:e,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};we.default=bt});var Gt=L(qe=>{"use strict";Object.defineProperty(qe,"__esModule",{value:!0});qe.version=void 0;qe.version="0.0.0-automated"});var Kt=L(ze=>{"use strict";Object.defineProperty(ze,"__esModule",{value:!0});ze.DEFAULT_HEADERS=void 0;var is=Gt();ze.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${is.version}`}});var Wt=L(be=>{"use strict";var Vt=be&&be.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(be,"__esModule",{value:!0});var ns=Vt(St()),os=Vt(Be()),as=Kt(),kt=class i{constructor(t,{headers:e={},schema:r,fetch:s}={}){this.url=t,this.headers=Object.assign(Object.assign({},as.DEFAULT_HEADERS),e),this.schemaName=r,this.fetch=s}from(t){let e=new URL(`${this.url}/${t}`);return new ns.default(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new i(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,e={},{head:r=!1,get:s=!1,count:n}={}){let o,a=new URL(`${this.url}/rpc/${t}`),c;r||s?(o=r?"HEAD":"GET",Object.entries(e).filter(([h,d])=>d!==void 0).map(([h,d])=>[h,Array.isArray(d)?`{${d.join(",")}}`:`${d}`]).forEach(([h,d])=>{a.searchParams.append(h,d)})):(o="POST",c=e);let l=Object.assign({},this.headers);return n&&(l.Prefer=`count=${n}`),new os.default({method:o,url:a,headers:l,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};be.default=kt});var rr=L(S=>{"use strict";var te=S&&S.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(S,"__esModule",{value:!0});S.PostgrestError=S.PostgrestBuilder=S.PostgrestTransformBuilder=S.PostgrestFilterBuilder=S.PostgrestQueryBuilder=S.PostgrestClient=void 0;var Yt=te(Wt());S.PostgrestClient=Yt.default;var Qt=te(St());S.PostgrestQueryBuilder=Qt.default;var Xt=te(Be());S.PostgrestFilterBuilder=Xt.default;var Zt=te(yt());S.PostgrestTransformBuilder=Zt.default;var er=te(mt());S.PostgrestBuilder=er.default;var tr=te(gt());S.PostgrestError=tr.default;S.default={PostgrestClient:Yt.default,PostgrestQueryBuilder:Qt.default,PostgrestFilterBuilder:Xt.default,PostgrestTransformBuilder:Zt.default,PostgrestBuilder:er.default,PostgrestError:tr.default}});var Ht=i=>{let t;return i?t=i:typeof fetch>"u"?t=(...e)=>import("./chunk-NPJLHOA5.js").then(({default:r})=>r(...e)):t=fetch,(...e)=>t(...e)};var pe=class extends Error{constructor(t,e="FunctionsError",r){super(t),this.name=e,this.context=r}},Ne=class extends pe{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}},Me=class extends pe{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}},Fe=class extends pe{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}},dt=function(i){return i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2",i}(dt||{});var Yr=function(i,t,e,r){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function a(h){try{l(r.next(h))}catch(d){o(d)}}function c(h){try{l(r.throw(h))}catch(d){o(d)}}function l(h){h.done?n(h.value):s(h.value).then(a,c)}l((r=r.apply(i,t||[])).next())})},ge=class{constructor(t,{headers:e={},customFetch:r,region:s=dt.Any}={}){this.url=t,this.headers=e,this.region=s,this.fetch=Ht(r)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,e={}){var r;return Yr(this,void 0,void 0,function*(){try{let{headers:s,method:n,body:o}=e,a={},{region:c}=e;c||(c=this.region),c&&c!=="any"&&(a["x-region"]=c);let l;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",l=o):typeof o=="string"?(a["Content-Type"]="text/plain",l=o):typeof FormData<"u"&&o instanceof FormData?l=o:(a["Content-Type"]="application/json",l=JSON.stringify(o)));let h=yield this.fetch(`${this.url}/${t}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:l}).catch(y=>{throw new Ne(y)}),d=h.headers.get("x-relay-error");if(d&&d==="true")throw new Me(h);if(!h.ok)throw new Fe(h);let p=((r=h.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),f;return p==="application/json"?f=yield h.json():p==="application/octet-stream"?f=yield h.blob():p==="text/event-stream"?f=h:p==="multipart/form-data"?f=yield h.formData():f=yield h.text(),{data:f,error:null}}catch(s){return{data:null,error:s}}})}};var sr=Kr(rr(),1),{PostgrestClient:ir,PostgrestQueryBuilder:ai,PostgrestFilterBuilder:ci,PostgrestTransformBuilder:li,PostgrestBuilder:hi,PostgrestError:cs}=sr.default;var nr="2.11.2";var or={"X-Client-Info":`realtime-js/${nr}`},ar="1.0.0",He=1e4,cr=1e3,re=function(i){return i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed",i}(re||{}),x=function(i){return i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving",i}(x||{}),T=function(i){return i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token",i}(T||{}),Et=function(i){return i.websocket="websocket",i}(Et||{}),q=function(i){return i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed",i}(q||{});var Je=class{constructor(){this.HEADER_LENGTH=1}decode(t,e){return t.constructor===ArrayBuffer?e(this._binaryDecode(t)):e(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){let e=new DataView(t),r=new TextDecoder;return this._decodeBroadcast(t,e,r)}_decodeBroadcast(t,e,r){let s=e.getUint8(1),n=e.getUint8(2),o=this.HEADER_LENGTH+2,a=r.decode(t.slice(o,o+s));o=o+s;let c=r.decode(t.slice(o,o+n));o=o+n;let l=JSON.parse(r.decode(t.slice(o,t.byteLength)));return{ref:null,topic:a,event:c,payload:l}}};var se=class{constructor(t,e){this.callback=t,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var w=function(i){return i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange",i}(w||{}),Tt=(i,t,e={})=>{var r;let s=(r=e.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(t).reduce((n,o)=>(n[o]=ls(o,i,t,s),n),{})},ls=(i,t,e,r)=>{let s=t.find(a=>a.name===i),n=s?.type,o=e[i];return n&&!r.includes(n)?lr(n,o):xt(o)},lr=(i,t)=>{if(i.charAt(0)==="_"){let e=i.slice(1,i.length);return fs(t,e)}switch(i){case w.bool:return hs(t);case w.float4:case w.float8:case w.int2:case w.int4:case w.int8:case w.numeric:case w.oid:return us(t);case w.json:case w.jsonb:return ds(t);case w.timestamp:return ps(t);case w.abstime:case w.date:case w.daterange:case w.int4range:case w.int8range:case w.money:case w.reltime:case w.text:case w.time:case w.timestamptz:case w.timetz:case w.tsrange:case w.tstzrange:return xt(t);default:return xt(t)}},xt=i=>i,hs=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},us=i=>{if(typeof i=="string"){let t=parseFloat(i);if(!Number.isNaN(t))return t}return i},ds=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(t){return console.log(`JSON parse error: ${t}`),i}return i},fs=(i,t)=>{if(typeof i!="string")return i;let e=i.length-1,r=i[e];if(i[0]==="{"&&r==="}"){let n,o=i.slice(1,e);try{n=JSON.parse("["+o+"]")}catch{n=o?o.split(","):[]}return n.map(a=>lr(t,a))}return i},ps=i=>typeof i=="string"?i.replace(" ","T"):i,Ge=i=>{let t=i;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};var ie=class{constructor(t,e,r={},s=He){this.channel=t,this.event=e,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,e){var r;return this._hasReceived(t)&&e((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:t,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let t=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:e}){this.recHooks.filter(r=>r.status===t).forEach(r=>r.callback(e))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}};var Se=class i{constructor(t,e){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let r=e?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{let{onJoin:n,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=i.syncState(this.state,s,n,o),this.pendingDiffs.forEach(c=>{this.state=i.syncDiff(this.state,c,n,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{let{onJoin:n,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=i.syncDiff(this.state,s,n,o),a())}),this.onJoin((s,n,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:n,newPresences:o})}),this.onLeave((s,n,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:n,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,e,r,s){let n=this.cloneDeep(t),o=this.transformState(e),a={},c={};return this.map(n,(l,h)=>{o[l]||(c[l]=h)}),this.map(o,(l,h)=>{let d=n[l];if(d){let p=h.map(v=>v.presence_ref),f=d.map(v=>v.presence_ref),y=h.filter(v=>f.indexOf(v.presence_ref)<0),m=d.filter(v=>p.indexOf(v.presence_ref)<0);y.length>0&&(a[l]=y),m.length>0&&(c[l]=m)}else a[l]=h}),this.syncDiff(n,{joins:a,leaves:c},r,s)}static syncDiff(t,e,r,s){let{joins:n,leaves:o}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(a,c)=>{var l;let h=(l=t[a])!==null&&l!==void 0?l:[];if(t[a]=this.cloneDeep(c),h.length>0){let d=t[a].map(f=>f.presence_ref),p=h.filter(f=>d.indexOf(f.presence_ref)<0);t[a].unshift(...p)}r(a,h,c)}),this.map(o,(a,c)=>{let l=t[a];if(!l)return;let h=c.map(d=>d.presence_ref);l=l.filter(d=>h.indexOf(d.presence_ref)<0),t[a]=l,s(a,l,c),l.length===0&&delete t[a]}),t}static map(t,e){return Object.getOwnPropertyNames(t).map(r=>e(r,t[r]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((e,r)=>{let s=t[r];return"metas"in s?e[r]=s.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):e[r]=s,e},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var U=function(i){return i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR",i}(U||{});var ke=class i{constructor(t,e={config:{}},r){this.topic=t,this.params=e,this.socket=r,this.bindings={},this.state=x.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new ie(this,T.join,this.params,this.timeout),this.rejoinTimer=new se(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=x.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=x.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=x.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=x.errored,this.rejoinTimer.scheduleTimeout())}),this._on(T.reply,{},(s,n)=>{this._trigger(this._replyEventName(n),s)}),this.presence=new Se(this),this.broadcastEndpointURL=Ge(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(t,e=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{let{config:{broadcast:n,presence:o,private:a}}=this.params;this._onError(h=>t?.(U.CHANNEL_ERROR,h)),this._onClose(()=>t?.(U.CLOSED));let c={},l={broadcast:n,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(h=>h.filter))!==null&&s!==void 0?s:[],private:a};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},c)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",d=>u(this,[d],function*({postgres_changes:h}){var p;if(this.socket.setAuth(),h===void 0){t?.(U.SUBSCRIBED);return}else{let f=this.bindings.postgres_changes,y=(p=f?.length)!==null&&p!==void 0?p:0,m=[];for(let v=0;v<y;v++){let k=f[v],{filter:{event:$,schema:C,table:O,filter:I}}=k,Q=h&&h[v];if(Q&&Q.event===$&&Q.schema===C&&Q.table===O&&Q.filter===I)m.push(Object.assign(Object.assign({},k),{id:Q.id}));else{this.unsubscribe(),t?.(U.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=m,t&&t(U.SUBSCRIBED);return}})).receive("error",h=>{t?.(U.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{t?.(U.TIMED_OUT)})}return this}presenceState(){return this.presence.state}track(r){return u(this,arguments,function*(t,e={}){return yield this.send({type:"presence",event:"track",payload:t},e.timeout||this.timeout)})}untrack(){return u(this,arguments,function*(t={}){return yield this.send({type:"presence",event:"untrack"},t)})}on(t,e,r){return this._on(t,e,r)}send(r){return u(this,arguments,function*(t,e={}){var s,n;if(!this._canPush()&&t.type==="broadcast"){let{event:o,payload:a}=t,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:a,private:this.private}]})};try{let h=yield this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=e.timeout)!==null&&s!==void 0?s:this.timeout);return yield(n=h.body)===null||n===void 0?void 0:n.cancel(),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var a,c,l;let h=this._push(t.type,t,e.timeout||this.timeout);t.type==="broadcast"&&!(!((l=(c=(a=this.params)===null||a===void 0?void 0:a.config)===null||c===void 0?void 0:c.broadcast)===null||l===void 0)&&l.ack)&&o("ok"),h.receive("ok",()=>o("ok")),h.receive("error",()=>o("error")),h.receive("timeout",()=>o("timed out"))})})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=x.leaving;let e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(T.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{let s=new ie(this,T.leave,{},t);s.receive("ok",()=>{e(),r("ok")}).receive("timeout",()=>{e(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_fetchWithTimeout(t,e,r){return u(this,null,function*(){let s=new AbortController,n=setTimeout(()=>s.abort(),r),o=yield this.socket.fetch(t,Object.assign(Object.assign({},e),{signal:s.signal}));return clearTimeout(n),o})}_push(t,e,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new ie(this,t,e,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(t,e,r){return e}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,e,r){var s,n;let o=t.toLocaleLowerCase(),{close:a,error:c,leave:l,join:h}=T;if(r&&[a,c,l,h].indexOf(o)>=0&&r!==this._joinRef())return;let p=this._onMessage(o,e,r);if(e&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(f=>{var y,m,v;return((y=f.filter)===null||y===void 0?void 0:y.event)==="*"||((v=(m=f.filter)===null||m===void 0?void 0:m.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===o}).map(f=>f.callback(p,r)):(n=this.bindings[o])===null||n===void 0||n.filter(f=>{var y,m,v,k,$,C;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){let O=f.id,I=(y=f.filter)===null||y===void 0?void 0:y.event;return O&&((m=e.ids)===null||m===void 0?void 0:m.includes(O))&&(I==="*"||I?.toLocaleLowerCase()===((v=e.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{let O=($=(k=f?.filter)===null||k===void 0?void 0:k.event)===null||$===void 0?void 0:$.toLocaleLowerCase();return O==="*"||O===((C=e?.event)===null||C===void 0?void 0:C.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof p=="object"&&"ids"in p){let y=p.data,{schema:m,table:v,commit_timestamp:k,type:$,errors:C}=y;p=Object.assign(Object.assign({},{schema:m,table:v,commit_timestamp:k,eventType:$,new:{},old:{},errors:C}),this._getPayloadRecords(y))}f.callback(p,r)})}_isClosed(){return this.state===x.closed}_isJoined(){return this.state===x.joined}_isJoining(){return this.state===x.joining}_isLeaving(){return this.state===x.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,e,r){let s=t.toLocaleLowerCase(),n={type:s,filter:e,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(t,e){let r=t.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var n;return!(((n=s.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===r&&i.isEqual(s.filter,e))}),this}static isEqual(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(let r in t)if(t[r]!==e[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(T.close,{},t)}_onError(t){this._on(T.error,{},e=>t(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=x.joining,this.joinPush.resend(t))}_getPayloadRecords(t){let e={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(e.new=Tt(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(e.old=Tt(t.columns,t.old_record)),e}};var _s=()=>{},ms=typeof WebSocket<"u",vs=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`,Ee=class{constructor(t,e){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=or,this.params={},this.timeout=He,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=_s,this.conn=null,this.sendBuffer=[],this.serializer=new Je,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=n=>{let o;return n?o=n:typeof fetch>"u"?o=(...a)=>import("./chunk-NPJLHOA5.js").then(({default:c})=>c(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${t}/${Et.websocket}`,this.httpEndpoint=Ge(t),e?.transport?this.transport=e.transport:this.transport=null,e?.params&&(this.params=e.params),e?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),e?.timeout&&(this.timeout=e.timeout),e?.logger&&(this.logger=e.logger),e?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);let s=(r=e?.params)===null||r===void 0?void 0:r.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=e?.reconnectAfterMs?e.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=e?.encode?e.encode:(n,o)=>o(JSON.stringify(n)),this.decode=e?.decode?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new se(()=>u(this,null,function*(){this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(e?.fetch),e?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=e?.worker||!1,this.workerUrl=e?.workerUrl}this.accessToken=e?.accessToken||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(ms){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new At(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),import("./chunk-GFTZZNGD.js").then(({default:t})=>{this.conn=new t(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:ar}))}disconnect(t,e){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,e??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(t){return u(this,null,function*(){let e=yield t.unsubscribe();return this.channels.length===0&&this.disconnect(),e})}removeAllChannels(){return u(this,null,function*(){let t=yield Promise.all(this.channels.map(e=>e.unsubscribe()));return this.disconnect(),t})}log(t,e,r){this.logger(t,e,r)}connectionState(){switch(this.conn&&this.conn.readyState){case re.connecting:return q.Connecting;case re.open:return q.Open;case re.closing:return q.Closing;default:return q.Closed}}isConnected(){return this.connectionState()===q.Open}channel(t,e={config:{}}){let r=new ke(`realtime:${t}`,e,this);return this.channels.push(r),r}push(t){let{topic:e,event:r,payload:s,ref:n}=t,o=()=>{this.encode(t,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};this.log("push",`${e} ${r} (${n})`,s),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(t=null){return u(this,null,function*(){let e=t||this.accessToken&&(yield this.accessToken())||this.accessTokenValue;if(e){let r=null;try{r=JSON.parse(atob(e.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=e,this.channels.forEach(s=>{e&&s.updateJoinPayload({access_token:e}),s.joinedOnce&&s._isJoined()&&s._push(T.access_token,{access_token:e})})}})}sendHeartbeat(){return u(this,null,function*(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(t=this.conn)===null||t===void 0||t.close(cr,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}})}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let e=this.channels.find(r=>r.topic===t&&(r._isJoined()||r._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${t}"`),e.unsubscribe())}_remove(t){this.channels=this.channels.filter(e=>e._joinRef()!==t._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_onConnMessage(t){this.decode(t.data,e=>{let{topic:r,event:s,payload:n,ref:o}=e;o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,n),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(s,n,o)),this.stateChangeCallbacks.message.forEach(a=>a(e))})}_onConnOpen(){return u(this,null,function*(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{e.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(t=>t())})}_onConnClose(t){this.log("transport","close",t),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(t))}_onConnError(t){this.log("transport",t.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(e=>e(t))}_triggerChanError(){this.channels.forEach(t=>t._trigger(T.error))}_appendParams(t,e){if(Object.keys(e).length===0)return t;let r=t.match(/\?/)?"&":"?",s=new URLSearchParams(e);return`${t}${r}${s}`}_workerObjectUrl(t){let e;if(t)e=t;else{let r=new Blob([vs],{type:"application/javascript"});e=URL.createObjectURL(r)}return e}};var At=class{constructor(t,e,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=re.connecting,this.send=()=>{},this.url=null,this.url=t,this.close=r.close}};var ne=class extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}};function b(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}var Ke=class extends ne{constructor(t,e){super(t),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}},z=class extends ne{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}};var ys=function(i,t,e,r){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function a(h){try{l(r.next(h))}catch(d){o(d)}}function c(h){try{l(r.throw(h))}catch(d){o(d)}}function l(h){h.done?n(h.value):s(h.value).then(a,c)}l((r=r.apply(i,t||[])).next())})},We=i=>{let t;return i?t=i:typeof fetch>"u"?t=(...e)=>import("./chunk-NPJLHOA5.js").then(({default:r})=>r(...e)):t=fetch,(...e)=>t(...e)},hr=()=>ys(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield import("./chunk-NPJLHOA5.js")).Response:Response}),Ve=i=>{if(Array.isArray(i))return i.map(e=>Ve(e));if(typeof i=="function"||i!==Object(i))return i;let t={};return Object.entries(i).forEach(([e,r])=>{let s=e.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace(/[-_]/g,""));t[s]=Ve(r)}),t};var H=function(i,t,e,r){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function a(h){try{l(r.next(h))}catch(d){o(d)}}function c(h){try{l(r.throw(h))}catch(d){o(d)}}function l(h){h.done?n(h.value):s(h.value).then(a,c)}l((r=r.apply(i,t||[])).next())})},Ot=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),ws=(i,t,e)=>H(void 0,void 0,void 0,function*(){let r=yield hr();i instanceof r&&!e?.noResolveJson?i.json().then(s=>{t(new Ke(Ot(s),i.status||500))}).catch(s=>{t(new z(Ot(s),s))}):t(new z(Ot(i),i))}),bs=(i,t,e,r)=>{let s={method:i,headers:t?.headers||{}};return i==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},t?.headers),r&&(s.body=JSON.stringify(r)),Object.assign(Object.assign({},s),e))};function xe(i,t,e,r,s,n){return H(this,void 0,void 0,function*(){return new Promise((o,a)=>{i(e,bs(t,r,s,n)).then(c=>{if(!c.ok)throw c;return r?.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>ws(c,a,r))})})}function oe(i,t,e,r){return H(this,void 0,void 0,function*(){return xe(i,"GET",t,e,r)})}function j(i,t,e,r,s){return H(this,void 0,void 0,function*(){return xe(i,"POST",t,r,s,e)})}function ur(i,t,e,r,s){return H(this,void 0,void 0,function*(){return xe(i,"PUT",t,r,s,e)})}function dr(i,t,e,r){return H(this,void 0,void 0,function*(){return xe(i,"HEAD",t,Object.assign(Object.assign({},e),{noResolveJson:!0}),r)})}function Ye(i,t,e,r,s){return H(this,void 0,void 0,function*(){return xe(i,"DELETE",t,r,s,e)})}var E=function(i,t,e,r){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function a(h){try{l(r.next(h))}catch(d){o(d)}}function c(h){try{l(r.throw(h))}catch(d){o(d)}}function l(h){h.done?n(h.value):s(h.value).then(a,c)}l((r=r.apply(i,t||[])).next())})},Ss={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},fr={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},Qe=class{constructor(t,e={},r,s){this.url=t,this.headers=e,this.bucketId=r,this.fetch=We(s)}uploadOrUpdate(t,e,r,s){return E(this,void 0,void 0,function*(){try{let n,o=Object.assign(Object.assign({},fr),s),a=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(o.upsert)}),c=o.metadata;typeof Blob<"u"&&r instanceof Blob?(n=new FormData,n.append("cacheControl",o.cacheControl),c&&n.append("metadata",this.encodeMetadata(c)),n.append("",r)):typeof FormData<"u"&&r instanceof FormData?(n=r,n.append("cacheControl",o.cacheControl),c&&n.append("metadata",this.encodeMetadata(c))):(n=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,c&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),s?.headers&&(a=Object.assign(Object.assign({},a),s.headers));let l=this._removeEmptyFolders(e),h=this._getFinalPath(l),d=yield this.fetch(`${this.url}/object/${h}`,Object.assign({method:t,body:n,headers:a},o?.duplex?{duplex:o.duplex}:{})),p=yield d.json();return d.ok?{data:{path:l,id:p.Id,fullPath:p.Key},error:null}:{data:null,error:p}}catch(n){if(b(n))return{data:null,error:n};throw n}})}upload(t,e,r){return E(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,e,r)})}uploadToSignedUrl(t,e,r,s){return E(this,void 0,void 0,function*(){let n=this._removeEmptyFolders(t),o=this._getFinalPath(n),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",e);try{let c,l=Object.assign({upsert:fr.upsert},s),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",l.cacheControl)):(c=r,h["cache-control"]=`max-age=${l.cacheControl}`,h["content-type"]=l.contentType);let d=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:h}),p=yield d.json();return d.ok?{data:{path:n,fullPath:p.Key},error:null}:{data:null,error:p}}catch(c){if(b(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(t,e){return E(this,void 0,void 0,function*(){try{let r=this._getFinalPath(t),s=Object.assign({},this.headers);e?.upsert&&(s["x-upsert"]="true");let n=yield j(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(this.url+n.url),a=o.searchParams.get("token");if(!a)throw new ne("No token returned by API");return{data:{signedUrl:o.toString(),path:t,token:a},error:null}}catch(r){if(b(r))return{data:null,error:r};throw r}})}update(t,e,r){return E(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,e,r)})}move(t,e,r){return E(this,void 0,void 0,function*(){try{return{data:yield j(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(b(s))return{data:null,error:s};throw s}})}copy(t,e,r){return E(this,void 0,void 0,function*(){try{return{data:{path:(yield j(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(b(s))return{data:null,error:s};throw s}})}createSignedUrl(t,e,r){return E(this,void 0,void 0,function*(){try{let s=this._getFinalPath(t),n=yield j(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:e},r?.transform?{transform:r.transform}:{}),{headers:this.headers}),o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${o}`)},{data:n,error:null}}catch(s){if(b(s))return{data:null,error:s};throw s}})}createSignedUrls(t,e,r){return E(this,void 0,void 0,function*(){try{let s=yield j(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:t},{headers:this.headers}),n=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${n}`):null})),error:null}}catch(s){if(b(s))return{data:null,error:s};throw s}})}download(t,e){return E(this,void 0,void 0,function*(){let s=typeof e?.transform<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString(e?.transform||{}),o=n?`?${n}`:"";try{let a=this._getFinalPath(t);return{data:yield(yield oe(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(b(a))return{data:null,error:a};throw a}})}info(t){return E(this,void 0,void 0,function*(){let e=this._getFinalPath(t);try{let r=yield oe(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers});return{data:Ve(r),error:null}}catch(r){if(b(r))return{data:null,error:r};throw r}})}exists(t){return E(this,void 0,void 0,function*(){let e=this._getFinalPath(t);try{return yield dr(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(b(r)&&r instanceof z){let s=r.originalError;if([400,404].includes(s?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(t,e){let r=this._getFinalPath(t),s=[],n=e?.download?`download=${e.download===!0?"":e.download}`:"";n!==""&&s.push(n);let a=typeof e?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(e?.transform||{});c!==""&&s.push(c);let l=s.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${l}`)}}}remove(t){return E(this,void 0,void 0,function*(){try{return{data:yield Ye(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(e){if(b(e))return{data:null,error:e};throw e}})}list(t,e,r){return E(this,void 0,void 0,function*(){try{let s=Object.assign(Object.assign(Object.assign({},Ss),e),{prefix:t||""});return{data:yield j(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(b(s))return{data:null,error:s};throw s}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){let e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};var pr="2.7.1";var gr={"X-Client-Info":`storage-js/${pr}`};var ae=function(i,t,e,r){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function a(h){try{l(r.next(h))}catch(d){o(d)}}function c(h){try{l(r.throw(h))}catch(d){o(d)}}function l(h){h.done?n(h.value):s(h.value).then(a,c)}l((r=r.apply(i,t||[])).next())})},Xe=class{constructor(t,e={},r){this.url=t,this.headers=Object.assign(Object.assign({},gr),e),this.fetch=We(r)}listBuckets(){return ae(this,void 0,void 0,function*(){try{return{data:yield oe(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(b(t))return{data:null,error:t};throw t}})}getBucket(t){return ae(this,void 0,void 0,function*(){try{return{data:yield oe(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(e){if(b(e))return{data:null,error:e};throw e}})}createBucket(t,e={public:!1}){return ae(this,void 0,void 0,function*(){try{return{data:yield j(this.fetch,`${this.url}/bucket`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(b(r))return{data:null,error:r};throw r}})}updateBucket(t,e){return ae(this,void 0,void 0,function*(){try{return{data:yield ur(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(b(r))return{data:null,error:r};throw r}})}emptyBucket(t){return ae(this,void 0,void 0,function*(){try{return{data:yield j(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(b(e))return{data:null,error:e};throw e}})}deleteBucket(t){return ae(this,void 0,void 0,function*(){try{return{data:yield Ye(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(e){if(b(e))return{data:null,error:e};throw e}})}};var Te=class extends Xe{constructor(t,e={},r){super(t,e,r)}from(t){return new Qe(this.url,this.headers,t,this.fetch)}};var _r="2.48.1";var Ae="";typeof Deno<"u"?Ae="deno":typeof document<"u"?Ae="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ae="react-native":Ae="node";var ks={"X-Client-Info":`supabase-js-${Ae}/${_r}`},mr={headers:ks},vr={schema:"public"},yr={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},wr={};zt();var Es=function(i,t,e,r){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function a(h){try{l(r.next(h))}catch(d){o(d)}}function c(h){try{l(r.throw(h))}catch(d){o(d)}}function l(h){h.done?n(h.value):s(h.value).then(a,c)}l((r=r.apply(i,t||[])).next())})},xs=i=>{let t;return i?t=i:typeof fetch>"u"?t=Bt:t=fetch,(...e)=>t(...e)},Ts=()=>typeof Headers>"u"?qt:Headers,br=(i,t,e)=>{let r=xs(e),s=Ts();return(n,o)=>Es(void 0,void 0,void 0,function*(){var a;let c=(a=yield t())!==null&&a!==void 0?a:i,l=new s(o?.headers);return l.has("apikey")||l.set("apikey",i),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),r(n,Object.assign(Object.assign({},o),{headers:l}))})};var As=function(i,t,e,r){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function a(h){try{l(r.next(h))}catch(d){o(d)}}function c(h){try{l(r.throw(h))}catch(d){o(d)}}function l(h){h.done?n(h.value):s(h.value).then(a,c)}l((r=r.apply(i,t||[])).next())})};function Sr(i){return i.replace(/\/$/,"")}function kr(i,t){let{db:e,auth:r,realtime:s,global:n}=i,{db:o,auth:a,realtime:c,global:l}=t,h={db:Object.assign(Object.assign({},o),e),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},c),s),global:Object.assign(Object.assign({},l),n),accessToken:()=>As(this,void 0,void 0,function*(){return""})};return i.accessToken?h.accessToken=i.accessToken:delete h.accessToken,h}var Ze="2.67.3";var Er="http://localhost:9999",xr="supabase.auth.token";var Tr={"X-Client-Info":`gotrue-js/${Ze}`},Pt=10;var Oe="X-Supabase-Api-Version",jt={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Ar(i){return Math.round(Date.now()/1e3)+i}function Or(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){let t=Math.random()*16|0;return(i=="x"?t:t&3|8).toString(16)})}var P=()=>typeof window<"u"&&typeof document<"u",J={tested:!1,writable:!1},F=()=>{if(!P())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(J.tested)return J.writable;let i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),J.tested=!0,J.writable=!0}catch{J.tested=!0,J.writable=!1}return J.writable};function Pr(i){let t={},e=new URL(i);if(e.hash&&e.hash[0]==="#")try{new URLSearchParams(e.hash.substring(1)).forEach((s,n)=>{t[n]=s})}catch{}return e.searchParams.forEach((r,s)=>{t[s]=r}),t}var et=i=>{let t;return i?t=i:typeof fetch>"u"?t=(...e)=>import("./chunk-NPJLHOA5.js").then(({default:r})=>r(...e)):t=fetch,(...e)=>t(...e)},jr=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",Rt=(i,t,e)=>u(void 0,null,function*(){yield i.setItem(t,JSON.stringify(e))}),je=(i,t)=>u(void 0,null,function*(){let e=yield i.getItem(t);if(!e)return null;try{return JSON.parse(e)}catch{return e}}),Re=(i,t)=>u(void 0,null,function*(){yield i.removeItem(t)});function Os(i){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="",r,s,n,o,a,c,l,h=0;for(i=i.replace("-","+").replace("_","/");h<i.length;)o=t.indexOf(i.charAt(h++)),a=t.indexOf(i.charAt(h++)),c=t.indexOf(i.charAt(h++)),l=t.indexOf(i.charAt(h++)),r=o<<2|a>>4,s=(a&15)<<4|c>>2,n=(c&3)<<6|l,e=e+String.fromCharCode(r),c!=64&&s!=0&&(e=e+String.fromCharCode(s)),l!=64&&n!=0&&(e=e+String.fromCharCode(n));return e}var Pe=class i{constructor(){this.promise=new i.promiseConstructor((t,e)=>{this.resolve=t,this.reject=e})}};Pe.promiseConstructor=Promise;function $t(i){let t=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,e=i.split(".");if(e.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!t.test(e[1]))throw new Error("JWT is not valid: payload is not in base64url format");let r=e[1];return JSON.parse(Os(r))}function Rr(i){return u(this,null,function*(){return yield new Promise(t=>{setTimeout(()=>t(null),i)})})}function $r(i,t){return new Promise((r,s)=>{u(this,null,function*(){for(let n=0;n<1/0;n++)try{let o=yield i(n);if(!t(n,null,o)){r(o);return}}catch(o){if(!t(n,o)){s(o);return}}})})}function Ps(i){return("0"+i.toString(16)).substr(-2)}function js(){let t=new Uint32Array(56);if(typeof crypto>"u"){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=e.length,s="";for(let n=0;n<56;n++)s+=e.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(t),Array.from(t,Ps).join("")}function Rs(i){return u(this,null,function*(){let e=new TextEncoder().encode(i),r=yield crypto.subtle.digest("SHA-256",e),s=new Uint8Array(r);return Array.from(s).map(n=>String.fromCharCode(n)).join("")})}function $s(i){return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function Cs(i){return u(this,null,function*(){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;let e=yield Rs(i);return $s(e)})}function G(i,t,e=!1){return u(this,null,function*(){let r=js(),s=r;e&&(s+="/PASSWORD_RECOVERY"),yield Rt(i,`${t}-code-verifier`,s);let n=yield Cs(r);return[n,r===n?"plain":"s256"]})}var Is=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Cr(i){let t=i.headers.get(Oe);if(!t||!t.match(Is))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}var $e=class extends Error{constructor(t,e,r){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=r}};function g(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}var tt=class extends $e{constructor(t,e,r){super(t,e,r),this.name="AuthApiError",this.status=e,this.code=r}};function Ir(i){return g(i)&&i.name==="AuthApiError"}var ce=class extends $e{constructor(t,e){super(t),this.name="AuthUnknownError",this.originalError=e}},D=class extends $e{constructor(t,e,r,s){super(t,r,s),this.name=e,this.status=r}},A=class extends D{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};function Lr(i){return g(i)&&i.name==="AuthSessionMissingError"}var le=class extends D{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}},K=class extends D{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}},V=class extends D{constructor(t,e=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};function Ur(i){return g(i)&&i.name==="AuthImplicitGrantRedirectError"}var Ce=class extends D{constructor(t,e=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},he=class extends D{constructor(t,e){super(t,"AuthRetryableFetchError",e,void 0)}};function rt(i){return g(i)&&i.name==="AuthRetryableFetchError"}var Ie=class extends D{constructor(t,e,r){super(t,"AuthWeakPasswordError",e,"weak_password"),this.reasons=r}};var Ls=function(i,t){var e={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&t.indexOf(r)<0&&(e[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(e[r[s]]=i[r[s]]);return e},W=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Us=[502,503,504];function Dr(i){return u(this,null,function*(){var t;if(!jr(i))throw new he(W(i),0);if(Us.includes(i.status))throw new he(W(i),i.status);let e;try{e=yield i.json()}catch(n){throw new ce(W(n),n)}let r,s=Cr(i);if(s&&s.getTime()>=jt["2024-01-01"].timestamp&&typeof e=="object"&&e&&typeof e.code=="string"?r=e.code:typeof e=="object"&&e&&typeof e.error_code=="string"&&(r=e.error_code),r){if(r==="weak_password")throw new Ie(W(e),i.status,((t=e.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(r==="session_not_found")throw new A}else if(typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((n,o)=>n&&typeof o=="string",!0))throw new Ie(W(e),i.status,e.weak_password.reasons);throw new tt(W(e),i.status||500,r)})}var Ds=(i,t,e,r)=>{let s={method:i,headers:t?.headers||{}};return i==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),e))};function _(i,t,e,r){return u(this,null,function*(){var s;let n=Object.assign({},r?.headers);n[Oe]||(n[Oe]=jt["2024-01-01"].name),r?.jwt&&(n.Authorization=`Bearer ${r.jwt}`);let o=(s=r?.query)!==null&&s!==void 0?s:{};r?.redirectTo&&(o.redirect_to=r.redirectTo);let a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=yield Ns(i,t,e+a,{headers:n,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(c):{data:Object.assign({},c),error:null}})}function Ns(i,t,e,r,s,n){return u(this,null,function*(){let o=Ds(t,r,s,n),a;try{a=yield i(e,Object.assign({},o))}catch(c){throw console.error(c),new he(W(c),0)}if(a.ok||(yield Dr(a)),r?.noResolveJson)return a;try{return yield a.json()}catch(c){yield Dr(c)}})}function N(i){var t;let e=null;Ms(i)&&(e=Object.assign({},i),i.expires_at||(e.expires_at=Ar(i.expires_in)));let r=(t=i.user)!==null&&t!==void 0?t:i;return{data:{session:e,user:r},error:null}}function Ct(i){let t=N(i);return!t.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((e,r)=>e&&typeof r=="string",!0)&&(t.data.weak_password=i.weak_password),t}function R(i){var t;return{data:{user:(t=i.user)!==null&&t!==void 0?t:i},error:null}}function Nr(i){return{data:i,error:null}}function Mr(i){let{action_link:t,email_otp:e,hashed_token:r,redirect_to:s,verification_type:n}=i,o=Ls(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:t,email_otp:e,hashed_token:r,redirect_to:s,verification_type:n},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function Fr(i){return i}function Ms(i){return i.access_token&&i.refresh_token&&i.expires_in}var Fs=function(i,t){var e={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&t.indexOf(r)<0&&(e[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(e[r[s]]=i[r[s]]);return e},ue=class{constructor({url:t="",headers:e={},fetch:r}){this.url=t,this.headers=e,this.fetch=et(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(t,e="global"){return u(this,null,function*(){try{return yield _(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(g(r))return{data:null,error:r};throw r}})}inviteUserByEmail(r){return u(this,arguments,function*(t,e={}){try{return yield _(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:R})}catch(s){if(g(s))return{data:{user:null},error:s};throw s}})}generateLink(t){return u(this,null,function*(){try{let{options:e}=t,r=Fs(t,["options"]),s=Object.assign(Object.assign({},r),e);return"newEmail"in r&&(s.new_email=r?.newEmail,delete s.newEmail),yield _(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Mr,redirectTo:e?.redirectTo})}catch(e){if(g(e))return{data:{properties:null,user:null},error:e};throw e}})}createUser(t){return u(this,null,function*(){try{return yield _(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:R})}catch(e){if(g(e))return{data:{user:null},error:e};throw e}})}listUsers(t){return u(this,null,function*(){var e,r,s,n,o,a,c;try{let l={nextPage:null,lastPage:0,total:0},h=yield _(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(e=t?.page)===null||e===void 0?void 0:e.toString())!==null&&r!==void 0?r:"",per_page:(n=(s=t?.perPage)===null||s===void 0?void 0:s.toString())!==null&&n!==void 0?n:""},xform:Fr});if(h.error)throw h.error;let d=yield h.json(),p=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(c=(a=h.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return f.length>0&&(f.forEach(y=>{let m=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(y.split(";")[1].split("=")[1]);l[`${v}Page`]=m}),l.total=parseInt(p)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(g(l))return{data:{users:[]},error:l};throw l}})}getUserById(t){return u(this,null,function*(){try{return yield _(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:R})}catch(e){if(g(e))return{data:{user:null},error:e};throw e}})}updateUserById(t,e){return u(this,null,function*(){try{return yield _(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:e,headers:this.headers,xform:R})}catch(r){if(g(r))return{data:{user:null},error:r};throw r}})}deleteUser(t,e=!1){return u(this,null,function*(){try{return yield _(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:e},xform:R})}catch(r){if(g(r))return{data:{user:null},error:r};throw r}})}_listFactors(t){return u(this,null,function*(){try{let{data:e,error:r}=yield _(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:e,error:r}}catch(e){if(g(e))return{data:null,error:e};throw e}})}_deleteFactor(t){return u(this,null,function*(){try{return{data:yield _(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(e){if(g(e))return{data:null,error:e};throw e}})}};var Br={getItem:i=>F()?globalThis.localStorage.getItem(i):null,setItem:(i,t)=>{F()&&globalThis.localStorage.setItem(i,t)},removeItem:i=>{F()&&globalThis.localStorage.removeItem(i)}};function It(i={}){return{getItem:t=>i[t]||null,setItem:(t,e)=>{i[t]=e},removeItem:t=>{delete i[t]}}}function qr(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var Y={debug:!!(globalThis&&F()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")},Le=class extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}},st=class extends Le{};function Lt(i,t,e){return u(this,null,function*(){Y.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,t);let r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),Y.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},t),yield Promise.resolve().then(()=>globalThis.navigator.locks.request(i,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},s=>u(this,null,function*(){if(s){Y.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,s.name);try{return yield e()}finally{Y.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,s.name)}}else{if(t===0)throw Y.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new st(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(Y.debug)try{let n=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield e()}})))})}qr();var Bs={url:Er,storageKey:xr,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Tr,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Ue=30*1e3,zr=3;function Hr(i,t,e){return u(this,null,function*(){return yield e()})}var Ut=(()=>{class i{constructor(e){var r,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=i.nextInstanceID,i.nextInstanceID+=1,this.instanceID>0&&P()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let n=Object.assign(Object.assign({},Bs),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new ue({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=et(n.fetch),this.lock=n.lock||Hr,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:P()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=Lt:this.lock=Hr,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:F()?this.storage=Br:(this.memoryStorage={},this.storage=It(this.memoryStorage)):(this.memoryStorage={},this.storage=It(this.memoryStorage)),P()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",o=>u(this,null,function*(){this._debug("received broadcast notification from other tab or client",o),yield this._notifyAllSubscribers(o.data.event,o.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Ze}) ${new Date().toISOString()}`,...e),this}initialize(){return u(this,null,function*(){return this.initializePromise?yield this.initializePromise:(this.initializePromise=u(this,null,function*(){return yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._initialize()}))}),yield this.initializePromise)})}_initialize(){return u(this,null,function*(){var e;try{let r=Pr(window.location.href),s="none";if(this._isImplicitGrantCallback(r)?s="implicit":(yield this._isPKCECallback(r))&&(s="pkce"),P()&&this.detectSessionInUrl&&s!=="none"){let{data:n,error:o}=yield this._getSessionFromURL(r,s);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),Ur(o)){let l=(e=o.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:o}}return yield this._removeSession(),{error:o}}let{session:a,redirectType:c}=n;return this._debug("#_initialize()","detected session in URL",a,"redirect type",c),yield this._saveSession(a),setTimeout(()=>u(this,null,function*(){c==="recovery"?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",a):yield this._notifyAllSubscribers("SIGNED_IN",a)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(r){return g(r)?{error:r}:{error:new ce("Unexpected error during initialization",r)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signInAnonymously(e){return u(this,null,function*(){var r,s,n;try{let o=yield _(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(r=e?.options)===null||r===void 0?void 0:r.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e?.options)===null||n===void 0?void 0:n.captchaToken}},xform:N}),{data:a,error:c}=o;if(c||!a)return{data:{user:null,session:null},error:c};let l=a.session,h=a.user;return a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:h,session:l},error:null}}catch(o){if(g(o))return{data:{user:null,session:null},error:o};throw o}})}signUp(e){return u(this,null,function*(){var r,s,n;try{let o;if("email"in e){let{email:d,password:p,options:f}=e,y=null,m=null;this.flowType==="pkce"&&([y,m]=yield G(this.storage,this.storageKey)),o=yield _(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:d,password:p,data:(r=f?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:y,code_challenge_method:m},xform:N})}else if("phone"in e){let{phone:d,password:p,options:f}=e;o=yield _(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:p,data:(s=f?.data)!==null&&s!==void 0?s:{},channel:(n=f?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:N})}else throw new K("You must provide either an email or phone number and a password");let{data:a,error:c}=o;if(c||!a)return{data:{user:null,session:null},error:c};let l=a.session,h=a.user;return a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:h,session:l},error:null}}catch(o){if(g(o))return{data:{user:null,session:null},error:o};throw o}})}signInWithPassword(e){return u(this,null,function*(){try{let r;if("email"in e){let{email:o,password:a,options:c}=e;r=yield _(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:a,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:Ct})}else if("phone"in e){let{phone:o,password:a,options:c}=e;r=yield _(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:a,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:Ct})}else throw new K("You must provide either an email or phone number and a password");let{data:s,error:n}=r;return n?{data:{user:null,session:null},error:n}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new le}:(s.session&&(yield this._saveSession(s.session),yield this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(r){if(g(r))return{data:{user:null,session:null},error:r};throw r}})}signInWithOAuth(e){return u(this,null,function*(){var r,s,n,o;return yield this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})})}exchangeCodeForSession(e){return u(this,null,function*(){return yield this.initializePromise,this._acquireLock(-1,()=>u(this,null,function*(){return this._exchangeCodeForSession(e)}))})}_exchangeCodeForSession(e){return u(this,null,function*(){let r=yield je(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(r??"").split("/");try{let{data:o,error:a}=yield _(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:N});if(yield Re(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new le}:(o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:n??null}),error:a})}catch(o){if(g(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}})}signInWithIdToken(e){return u(this,null,function*(){try{let{options:r,provider:s,token:n,access_token:o,nonce:a}=e,c=yield _(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:o,nonce:a,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:N}),{data:l,error:h}=c;return h?{data:{user:null,session:null},error:h}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new le}:(l.session&&(yield this._saveSession(l.session),yield this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:h})}catch(r){if(g(r))return{data:{user:null,session:null},error:r};throw r}})}signInWithOtp(e){return u(this,null,function*(){var r,s,n,o,a;try{if("email"in e){let{email:c,options:l}=e,h=null,d=null;this.flowType==="pkce"&&([h,d]=yield G(this.storage,this.storageKey));let{error:p}=yield _(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(r=l?.data)!==null&&r!==void 0?r:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:h,code_challenge_method:d},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:p}}if("phone"in e){let{phone:c,options:l}=e,{data:h,error:d}=yield _(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(o=l?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(a=l?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:h?.message_id},error:d}}throw new K("You must provide either an email or phone number.")}catch(c){if(g(c))return{data:{user:null,session:null},error:c};throw c}})}verifyOtp(e){return u(this,null,function*(){var r,s;try{let n,o;"options"in e&&(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo,o=(s=e.options)===null||s===void 0?void 0:s.captchaToken);let{data:a,error:c}=yield _(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:n,xform:N});if(c)throw c;if(!a)throw new Error("An error occurred on token verification.");let l=a.session,h=a.user;return l?.access_token&&(yield this._saveSession(l),yield this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:h,session:l},error:null}}catch(n){if(g(n))return{data:{user:null,session:null},error:n};throw n}})}signInWithSSO(e){return u(this,null,function*(){var r,s,n;try{let o=null,a=null;return this.flowType==="pkce"&&([o,a]=yield G(this.storage,this.storageKey)),yield _(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:a}),headers:this.headers,xform:Nr})}catch(o){if(g(o))return{data:null,error:o};throw o}})}reauthenticate(){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._reauthenticate()}))})}_reauthenticate(){return u(this,null,function*(){try{return yield this._useSession(e=>u(this,null,function*(){let{data:{session:r},error:s}=e;if(s)throw s;if(!r)throw new A;let{error:n}=yield _(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:n}}))}catch(e){if(g(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return u(this,null,function*(){try{let r=`${this.url}/resend`;if("email"in e){let{email:s,type:n,options:o}=e,{error:a}=yield _(this.fetch,"POST",r,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:o?.captchaToken}},redirectTo:o?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){let{phone:s,type:n,options:o}=e,{data:a,error:c}=yield _(this.fetch,"POST",r,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:o?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:c}}throw new K("You must provide either an email or phone number and a type")}catch(r){if(g(r))return{data:{user:null,session:null},error:r};throw r}})}getSession(){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return this._useSession(r=>u(this,null,function*(){return r}))}))})}_acquireLock(e,r){return u(this,null,function*(){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=u(this,null,function*(){return yield s,yield r()});return this.pendingInLock.push(u(this,null,function*(){try{yield n}catch{}})),n}return yield this.lock(`lock:${this.storageKey}`,e,()=>u(this,null,function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let s=r();for(this.pendingInLock.push(u(this,null,function*(){try{yield s}catch{}})),yield s;this.pendingInLock.length;){let n=[...this.pendingInLock];yield Promise.all(n),this.pendingInLock.splice(0,n.length)}return yield s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}})}_useSession(e){return u(this,null,function*(){this._debug("#_useSession","begin");try{let r=yield this.__loadSession();return yield e(r)}finally{this._debug("#_useSession","end")}})}__loadSession(){return u(this,null,function*(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null,r=yield je(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession())),!e)return{data:{session:null},error:null};let s=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,h,d)=>(!a&&h==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,h,d))})}return{data:{session:e},error:null}}let{session:n,error:o}=yield this._callRefreshToken(e.refresh_token);return o?{data:{session:null},error:o}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}})}getUser(e){return u(this,null,function*(){return e?yield this._getUser(e):(yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._getUser()})))})}_getUser(e){return u(this,null,function*(){try{return e?yield _(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:R}):yield this._useSession(r=>u(this,null,function*(){var s,n,o;let{data:a,error:c}=r;if(c)throw c;return!(!((s=a.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new A}:yield _(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&o!==void 0?o:void 0,xform:R})}))}catch(r){if(g(r))return Lr(r)&&(yield this._removeSession(),yield Re(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}})}updateUser(s){return u(this,arguments,function*(e,r={}){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._updateUser(e,r)}))})}_updateUser(s){return u(this,arguments,function*(e,r={}){try{return yield this._useSession(n=>u(this,null,function*(){let{data:o,error:a}=n;if(a)throw a;if(!o.session)throw new A;let c=o.session,l=null,h=null;this.flowType==="pkce"&&e.email!=null&&([l,h]=yield G(this.storage,this.storageKey));let{data:d,error:p}=yield _(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:h}),jwt:c.access_token,xform:R});if(p)throw p;return c.user=d.user,yield this._saveSession(c),yield this._notifyAllSubscribers("USER_UPDATED",c),{data:{user:c.user},error:null}}))}catch(n){if(g(n))return{data:{user:null},error:n};throw n}})}_decodeJWT(e){return $t(e)}setSession(e){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._setSession(e)}))})}_setSession(e){return u(this,null,function*(){try{if(!e.access_token||!e.refresh_token)throw new A;let r=Date.now()/1e3,s=r,n=!0,o=null,a=$t(e.access_token);if(a.exp&&(s=a.exp,n=s<=r),n){let{session:c,error:l}=yield this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!c)return{data:{user:null,session:null},error:null};o=c}else{let{data:c,error:l}=yield this._getUser(e.access_token);if(l)throw l;o={access_token:e.access_token,refresh_token:e.refresh_token,user:c.user,token_type:"bearer",expires_in:s-r,expires_at:s},yield this._saveSession(o),yield this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(r){if(g(r))return{data:{session:null,user:null},error:r};throw r}})}refreshSession(e){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._refreshSession(e)}))})}_refreshSession(e){return u(this,null,function*(){try{return yield this._useSession(r=>u(this,null,function*(){var s;if(!e){let{data:a,error:c}=r;if(c)throw c;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!e?.refresh_token)throw new A;let{session:n,error:o}=yield this._callRefreshToken(e.refresh_token);return o?{data:{user:null,session:null},error:o}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}}))}catch(r){if(g(r))return{data:{user:null,session:null},error:r};throw r}})}_getSessionFromURL(e,r){return u(this,null,function*(){try{if(!P())throw new V("No browser detected.");if(e.error||e.error_description||e.error_code)throw new V(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new Ce("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new V("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ce("No code detected.");let{data:C,error:O}=yield this._exchangeCodeForSession(e.code);if(O)throw O;let I=new URL(window.location.href);return I.searchParams.delete("code"),window.history.replaceState(window.history.state,"",I.toString()),{data:{session:C.session,redirectType:null},error:null}}let{provider_token:s,provider_refresh_token:n,access_token:o,refresh_token:a,expires_in:c,expires_at:l,token_type:h}=e;if(!o||!c||!a||!h)throw new V("No session defined in URL");let d=Math.round(Date.now()/1e3),p=parseInt(c),f=d+p;l&&(f=parseInt(l));let y=f-d;y*1e3<=Ue&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${y}s, should have been closer to ${p}s`);let m=f-p;d-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,f,d):d-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,f,d);let{data:v,error:k}=yield this._getUser(o);if(k)throw k;let $={provider_token:s,provider_refresh_token:n,access_token:o,expires_in:p,expires_at:f,refresh_token:a,token_type:h,user:v.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:$,redirectType:e.type},error:null}}catch(s){if(g(s))return{data:{session:null,redirectType:null},error:s};throw s}})}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}_isPKCECallback(e){return u(this,null,function*(){let r=yield je(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)})}signOut(){return u(this,arguments,function*(e={scope:"global"}){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._signOut(e)}))})}_signOut(){return u(this,arguments,function*({scope:e}={scope:"global"}){return yield this._useSession(r=>u(this,null,function*(){var s;let{data:n,error:o}=r;if(o)return{error:o};let a=(s=n.session)===null||s===void 0?void 0:s.access_token;if(a){let{error:c}=yield this.admin.signOut(a,e);if(c&&!(Ir(c)&&(c.status===404||c.status===401||c.status===403)))return{error:c}}return e!=="others"&&(yield this._removeSession(),yield Re(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))})}onAuthStateChange(e){let r=Or(),s={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,s),u(this,null,function*(){yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){this._emitInitialSession(r)}))}),{data:{subscription:s}}}_emitInitialSession(e){return u(this,null,function*(){return yield this._useSession(r=>u(this,null,function*(){var s,n;try{let{data:{session:o},error:a}=r;if(a)throw a;yield(s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",o),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){yield(n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}}))})}resetPasswordForEmail(s){return u(this,arguments,function*(e,r={}){let n=null,o=null;this.flowType==="pkce"&&([n,o]=yield G(this.storage,this.storageKey,!0));try{return yield _(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:o,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(a){if(g(a))return{data:null,error:a};throw a}})}getUserIdentities(){return u(this,null,function*(){var e;try{let{data:r,error:s}=yield this.getUser();if(s)throw s;return{data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(r){if(g(r))return{data:null,error:r};throw r}})}linkIdentity(e){return u(this,null,function*(){var r;try{let{data:s,error:n}=yield this._useSession(o=>u(this,null,function*(){var a,c,l,h,d;let{data:p,error:f}=o;if(f)throw f;let y=yield this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(c=e.options)===null||c===void 0?void 0:c.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return yield _(this.fetch,"GET",y,{headers:this.headers,jwt:(d=(h=p.session)===null||h===void 0?void 0:h.access_token)!==null&&d!==void 0?d:void 0})}));if(n)throw n;return P()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(s?.url),{data:{provider:e.provider,url:s?.url},error:null}}catch(s){if(g(s))return{data:{provider:e.provider,url:null},error:s};throw s}})}unlinkIdentity(e){return u(this,null,function*(){try{return yield this._useSession(r=>u(this,null,function*(){var s,n;let{data:o,error:a}=r;if(a)throw a;return yield _(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})}))}catch(r){if(g(r))return{data:null,error:r};throw r}})}_refreshAccessToken(e){return u(this,null,function*(){let r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{let s=Date.now();return yield $r(n=>u(this,null,function*(){return n>0&&(yield Rr(200*Math.pow(2,n-1))),this._debug(r,"refreshing attempt",n),yield _(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:N})}),(n,o)=>{let a=200*Math.pow(2,n);return o&&rt(o)&&Date.now()+a-s<Ue})}catch(s){if(this._debug(r,"error",s),g(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(r,"end")}})}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,r){return u(this,null,function*(){let s=yield this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",s),P()&&!r.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}})}_recoverAndRefresh(){return u(this,null,function*(){var e;let r="#_recoverAndRefresh()";this._debug(r,"begin");try{let s=yield je(this.storage,this.storageKey);if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),s!==null&&(yield this._removeSession());return}let n=Math.round(Date.now()/1e3),o=((e=s.expires_at)!==null&&e!==void 0?e:1/0)<n+Pt;if(this._debug(r,`session has${o?"":" not"} expired with margin of ${Pt}s`),o){if(this.autoRefreshToken&&s.refresh_token){let{error:a}=yield this._callRefreshToken(s.refresh_token);a&&(console.error(a),rt(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),yield this._removeSession()))}}else yield this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(r,"error",s),console.error(s);return}finally{this._debug(r,"end")}})}_callRefreshToken(e){return u(this,null,function*(){var r,s;if(!e)throw new A;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Pe;let{data:o,error:a}=yield this._refreshAccessToken(e);if(a)throw a;if(!o.session)throw new A;yield this._saveSession(o.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);let c={session:o.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(o){if(this._debug(n,"error",o),g(o)){let a={session:null,error:o};return rt(o)||(yield this._removeSession()),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(o),o}finally{this.refreshingDeferred=null,this._debug(n,"end")}})}_notifyAllSubscribers(e,r,s=!0){return u(this,null,function*(){let n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",r,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:r});let o=[],a=Array.from(this.stateChangeEmitters.values()).map(c=>u(this,null,function*(){try{yield c.callback(e,r)}catch(l){o.push(l)}}));if(yield Promise.all(a),o.length>0){for(let c=0;c<o.length;c+=1)console.error(o[c]);throw o[0]}}finally{this._debug(n,"end")}})}_saveSession(e){return u(this,null,function*(){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,yield Rt(this.storage,this.storageKey,e)})}_removeSession(){return u(this,null,function*(){this._debug("#_removeSession()"),yield Re(this.storage,this.storageKey),yield this._notifyAllSubscribers("SIGNED_OUT",null)})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&P()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}_startAutoRefresh(){return u(this,null,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),Ue);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(()=>u(this,null,function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}),0)})}_stopAutoRefresh(){return u(this,null,function*(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return u(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return u(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return u(this,null,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{yield this._acquireLock(0,()=>u(this,null,function*(){try{let e=Date.now();try{return yield this._useSession(r=>u(this,null,function*(){let{data:{session:s}}=r;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let n=Math.floor((s.expires_at*1e3-e)/Ue);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${Ue}ms, refresh threshold is ${zr} ticks`),n<=zr&&(yield this._callRefreshToken(s.refresh_token))}))}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(e.isAcquireTimeout||e instanceof Le)this._debug("auto refresh token tick lock not available");else throw e}})}_handleVisibilityChange(){return u(this,null,function*(){if(this._debug("#_handleVisibilityChange()"),!P()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>u(this,null,function*(){return yield this._onVisibilityChanged(!1)}),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return u(this,null,function*(){let r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}yield this._recoverAndRefresh()})))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,r,s){return u(this,null,function*(){let n=[`provider=${encodeURIComponent(r)}`];if(s?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){let[o,a]=yield G(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(a)}`});n.push(c.toString())}if(s?.queryParams){let o=new URLSearchParams(s.queryParams);n.push(o.toString())}return s?.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`})}_unenroll(e){return u(this,null,function*(){try{return yield this._useSession(r=>u(this,null,function*(){var s;let{data:n,error:o}=r;return o?{data:null,error:o}:yield _(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token})}))}catch(r){if(g(r))return{data:null,error:r};throw r}})}_enroll(e){return u(this,null,function*(){try{return yield this._useSession(r=>u(this,null,function*(){var s,n;let{data:o,error:a}=r;if(a)return{data:null,error:a};let c=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:h}=yield _(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(s=o?.session)===null||s===void 0?void 0:s.access_token});return h?{data:null,error:h}:(e.factorType==="totp"&&(!((n=l?.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})}))}catch(r){if(g(r))return{data:null,error:r};throw r}})}_verify(e){return u(this,null,function*(){return this._acquireLock(-1,()=>u(this,null,function*(){try{return yield this._useSession(r=>u(this,null,function*(){var s;let{data:n,error:o}=r;if(o)return{data:null,error:o};let{data:a,error:c}=yield _(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token});return c?{data:null,error:c}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:c})}))}catch(r){if(g(r))return{data:null,error:r};throw r}}))})}_challenge(e){return u(this,null,function*(){return this._acquireLock(-1,()=>u(this,null,function*(){try{return yield this._useSession(r=>u(this,null,function*(){var s;let{data:n,error:o}=r;return o?{data:null,error:o}:yield _(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token})}))}catch(r){if(g(r))return{data:null,error:r};throw r}}))})}_challengeAndVerify(e){return u(this,null,function*(){let{data:r,error:s}=yield this._challenge({factorId:e.factorId});return s?{data:null,error:s}:yield this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})})}_listFactors(){return u(this,null,function*(){let{data:{user:e},error:r}=yield this.getUser();if(r)return{data:null,error:r};let s=e?.factors||[],n=s.filter(a=>a.factor_type==="totp"&&a.status==="verified"),o=s.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:s,totp:n,phone:o},error:null}})}_getAuthenticatorAssuranceLevel(){return u(this,null,function*(){return this._acquireLock(-1,()=>u(this,null,function*(){return yield this._useSession(e=>u(this,null,function*(){var r,s;let{data:{session:n},error:o}=e;if(o)return{data:null,error:o};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let a=this._decodeJWT(n.access_token),c=null;a.aal&&(c=a.aal);let l=c;((s=(r=n.user.factors)===null||r===void 0?void 0:r.filter(p=>p.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(l="aal2");let d=a.amr||[];return{data:{currentLevel:c,nextLevel:l,currentAuthenticationMethods:d},error:null}}))}))})}}return i.nextInstanceID=0,i})();var qs=Ut,Dt=qs;var it=class extends Dt{constructor(t){super(t)}};var zs=function(i,t,e,r){function s(n){return n instanceof e?n:new e(function(o){o(n)})}return new(e||(e=Promise))(function(n,o){function a(h){try{l(r.next(h))}catch(d){o(d)}}function c(h){try{l(r.throw(h))}catch(d){o(d)}}function l(h){h.done?n(h.value):s(h.value).then(a,c)}l((r=r.apply(i,t||[])).next())})},nt=class{constructor(t,e,r){var s,n,o;if(this.supabaseUrl=t,this.supabaseKey=e,!t)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");let a=Sr(t);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;let c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l={db:vr,realtime:wr,auth:Object.assign(Object.assign({},yr),{storageKey:c}),global:mr},h=kr(r??{},l);this.storageKey=(s=h.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(n=h.global.headers)!==null&&n!==void 0?n:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(d,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=h.auth)!==null&&o!==void 0?o:{},this.headers,h.global.fetch),this.fetch=br(e,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new ir(`${a}/rest/v1`,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),h.accessToken||this._listenForAuthEvents()}get functions(){return new ge(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Te(this.storageUrl,this.headers,this.fetch)}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},r={}){return this.rest.rpc(t,e,r)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,e;return zs(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();let{data:r}=yield this.auth.getSession();return(e=(t=r.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:null})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:s,storageKey:n,flowType:o,lock:a,debug:c},l,h){let d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new it({url:this.authUrl,headers:Object.assign(Object.assign({},d),l),storageKey:n,autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:s,flowType:o,lock:a,debug:c,fetch:h,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(t){return new Ee(this.realtimeUrl,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,r)=>{this._handleTokenChanged(e,"CLIENT",r?.access_token)})}_handleTokenChanged(t,e,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};var ot=(i,t,e)=>new nt(i,t,e);var at=class i{supabase;authStateCallback=null;currentUserSignal=fe(null);sessionSignal=fe(null);isLoadingSignal=fe(!1);errorSignal=fe(null);constructor(){this.initialize()}initialize(){try{if(!M.SUPABASE_URL||!M.SUPABASE_ANON_KEY){this.errorSignal.set("Configura\xE7\xE3o do Supabase incompleta. Verifique as vari\xE1veis de ambiente.");return}this.supabase=ot(M.SUPABASE_URL,M.SUPABASE_ANON_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}}),this.supabase.auth.onAuthStateChange((t,e)=>{this.sessionSignal.set(e),e?.user?this.currentUserSignal.set(e.user):this.currentUserSignal.set(null),this.authStateCallback&&(t==="SIGNED_IN"||t==="TOKEN_REFRESHED"?this.authStateCallback(e):(t==="SIGNED_OUT"||t==="USER_UPDATED")&&this.authStateCallback(null))}),this.checkCurrentSession()}catch(t){let e=t instanceof Error?t.message:"Erro desconhecido";this.errorSignal.set(`Erro ao inicializar cliente Supabase: ${e}`)}}checkCurrentSession(){return u(this,null,function*(){try{this.isLoadingSignal.set(!0);let{data:t,error:e}=yield this.supabase.auth.getSession();if(e){this.errorSignal.set(`Erro ao verificar sess\xE3o: ${e.message}`);return}this.sessionSignal.set(t.session),this.currentUserSignal.set(t.session?.user||null)}catch(t){let e=t instanceof Error?t.message:"Erro desconhecido";this.errorSignal.set(`Erro ao verificar sess\xE3o: ${e}`)}finally{this.isLoadingSignal.set(!1)}})}signInWithEmailAndPassword(t,e){return u(this,null,function*(){try{this.isLoadingSignal.set(!0),this.errorSignal.set(null);let r=yield this.supabase.auth.signInWithPassword({email:t,password:e});if(r.error)throw this.errorSignal.set(`Erro ao fazer login: ${r.error.message}`),r.error;return r}catch(r){let s=r instanceof Error?r.message:"Erro desconhecido";throw this.errorSignal.set(`Erro ao fazer login: ${s}`),r}finally{this.isLoadingSignal.set(!1)}})}signUp(t,e,r){return u(this,null,function*(){try{this.isLoadingSignal.set(!0),this.errorSignal.set(null);let{data:s,error:n}=yield this.supabase.auth.signUp({email:t,password:e,options:{data:r}});if(n)throw this.errorSignal.set(`Erro ao registrar usu\xE1rio: ${n.message}`),n;return s}catch(s){let n=s instanceof Error?s.message:"Erro desconhecido";throw this.errorSignal.set(`Erro ao registrar usu\xE1rio: ${n}`),s}finally{this.isLoadingSignal.set(!1)}})}signOut(){return u(this,null,function*(){try{this.isLoadingSignal.set(!0),this.errorSignal.set(null);let{error:t}=yield this.supabase.auth.signOut();if(t)throw this.errorSignal.set(`Erro ao fazer logout: ${t.message}`),t}catch(t){let e=t instanceof Error?t.message:"Erro desconhecido";throw this.errorSignal.set(`Erro ao fazer logout: ${e}`),t}finally{this.isLoadingSignal.set(!1)}})}resetPassword(t,e){return u(this,null,function*(){try{this.isLoadingSignal.set(!0),this.errorSignal.set(null);let{error:r}=yield this.supabase.auth.resetPasswordForEmail(t,{redirectTo:e});if(r)throw this.errorSignal.set(`Erro ao recuperar senha: ${r.message}`),r}catch(r){let s=r instanceof Error?r.message:"Erro desconhecido";throw this.errorSignal.set(`Erro ao recuperar senha: ${s}`),r}finally{this.isLoadingSignal.set(!1)}})}updatePassword(t){return u(this,null,function*(){try{this.isLoadingSignal.set(!0),this.errorSignal.set(null);let{error:e}=yield this.supabase.auth.updateUser({password:t});if(e)throw this.errorSignal.set(`Erro ao atualizar senha: ${e.message}`),e}catch(e){let r=e instanceof Error?e.message:"Erro desconhecido";throw this.errorSignal.set(`Erro ao atualizar senha: ${r}`),e}finally{this.isLoadingSignal.set(!1)}})}onAuthStateChanged(t){this.authStateCallback=t,this.getCurrentUser().then(e=>{t&&t(e)})}getCurrentUser(){return u(this,null,function*(){try{let{data:t,error:e}=yield this.supabase.auth.getUser();if(e){if(e.message.includes("session"))return null;throw this.errorSignal.set(`Erro ao obter usu\xE1rio atual: ${e.message}`),e}return this.currentUserSignal.set(t.user),t.user}catch(t){let e=t instanceof Error?t.message:"Erro desconhecido";return this.errorSignal.set(`Erro ao obter usu\xE1rio atual: ${e}`),null}})}getAccessToken(){return u(this,null,function*(){try{let{data:t,error:e}=yield this.supabase.auth.getSession();return e?(this.errorSignal.set(`Erro ao obter token de acesso: ${e.message}`),null):t.session?.access_token||null}catch(t){let e=t instanceof Error?t.message:"Erro desconhecido";return this.errorSignal.set(`Erro ao obter token de acesso: ${e}`),null}})}get user(){return this.currentUserSignal}get session(){return this.sessionSignal}get isLoading(){return this.isLoadingSignal}get error(){return this.errorSignal}static \u0275fac=function(e){return new(e||i)};static \u0275prov=ee({token:i,factory:i.\u0275fac,providedIn:"root"})};var ct=ot(M.SUPABASE_URL,M.SUPABASE_ADMIN_KEY,{auth:{persistSession:!1,autoRefreshToken:!1}}),lt=class i{supabase=ct;constructor(){}getByID(t,e){return u(this,null,function*(){return ct.from(t).select("*").eq("id",e).single().then(({data:r,error:s})=>{if(s)throw s;return r})})}getAll(t){return u(this,null,function*(){return ct.from(t).select("*").then(({data:e,error:r})=>{if(r)throw new Error(r.message);return e||[]})})}getUserProfile(t){return u(this,null,function*(){return ct.from("profiles").select("*").eq("id",t).single()})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=ee({token:i,factory:i.\u0275fac,providedIn:"root"})};var Gr=class i{authProvider=de(at);database=de(lt);authStore=de(Ft);router=de(Mt);constructor(){this.authProvider.onAuthStateChanged(t=>{t?this.handleSession(t):this.authStore.clearSession()}),ut(()=>{let t=this.authProvider.error();t&&this.authStore.setError(t)}),ut(()=>{let t=this.authProvider.isLoading();this.authStore.setLoading(t)}),this.checkCurrentUser()}checkCurrentUser(){return u(this,null,function*(){try{let t=yield this.authProvider.getCurrentUser();if(t){let e=yield this.authProvider.getAccessToken(),r={user:t,access_token:e,refresh_token:"",expires_in:3600};this.handleSession(r)}}catch(t){let e=t instanceof Error?t.message:"Erro desconhecido";this.authStore.setError(`Erro ao verificar usu\xE1rio atual: ${e}`)}})}login(t,e){return this.authStore.setLoading(!0),this.authStore.setError(null),B(this.authProvider.signInWithEmailAndPassword(t,e)).pipe(Nt(r=>{if(r.error)throw new Error(r.error.message);return this.getUserProfile(r.data.user.id)}),De(r=>{this.authStore.updateUser(r),this.authStore.setLoading(!1)}),Z(r=>(this.authStore.setError(r.message),this.authStore.setLoading(!1),X(()=>r))))}register(t,e,r){return B(this.authProvider.signUp(t,e,r)).pipe(ht(s=>this.handleSession(s.session)),De(()=>{this.router.navigate(["/dashboard"])}),Z(s=>{let n=s instanceof Error?s.message:"Erro desconhecido";return this.authStore.setError(`Erro ao realizar registro: ${n}`),X(()=>s)}))}logout(){return B(this.authProvider.signOut()).pipe(De(()=>{this.authStore.clearSession(),this.router.navigate(["/auth/login"])}),Z(t=>{let e=t instanceof Error?t.message:"Erro desconhecido";return this.authStore.setError(`Erro ao realizar logout: ${e}`),X(()=>t)}))}resetPassword(t){let e=`${window.location.origin}/auth/nova-senha`;return B(this.authProvider.resetPassword(t,e)).pipe(Z(r=>{let s=r instanceof Error?r.message:"Erro desconhecido";return this.authStore.setError(`Erro ao solicitar recupera\xE7\xE3o de senha: ${s}`),X(()=>r)}))}updatePassword(t){return B(this.authProvider.updatePassword(t)).pipe(Z(e=>{let r=e instanceof Error?e.message:"Erro desconhecido";return this.authStore.setError(`Erro ao atualizar senha: ${r}`),X(()=>e)}))}handleSession(t){if(!t)throw new Error("Sess\xE3o inv\xE1lida");let e={access_token:t.access_token,refresh_token:t.refresh_token||"",expires_in:t.expires_in||3600,user:this.mapProviderUser(t.user)};return this.authStore.setSession(e),e}mapProviderUser(t){let e=t.user_metadata||t.metadata||{};return console.log(t.user_metadata),{id:t.id||t.uid,email:t.email,role:e.role||"cliente",nome_completo:e.nome_completo||t.displayName||"",cpf_cnpj:e.cpf_cnpj||"",telefone:e.telefone||"",created_at:t.created_at||t.createdAt||new Date().toISOString(),last_sign_in_at:t.last_sign_in_at||t.lastLoginAt||"",metadata:{crc:e.crc||"",empresa:e.empresa||"",cargo:e.cargo||""}}}getUserProfile(t){return B(this.database.getUserProfile(t)).pipe().pipe(ht(e=>{if(e.error)throw new Error(e.error.message);return e.data}))}static \u0275fac=function(e){return new(e||i)};static \u0275prov=ee({token:i,factory:i.\u0275fac,providedIn:"root"})};export{ot as a,lt as b,Gr as c};
